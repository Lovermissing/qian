<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Qian Xuesen Memorial</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        @font-face {
            font-family: 'Cambria';
            src: local('Cambria'), local('Cambria Math');
        }
        
        body {
            font-family: 'Cambria', serif;
            margin: 0;
            padding: 0;
            height: 100vh;
            background: url('images/qianxueseng.jpg') no-repeat center center fixed;
            background-size: cover;
            color: #333;
            overflow: hidden;
            position: relative;
        }
        
        .main-title {
            position: absolute;
            top: 20%;
            left: 0;
            width: 100%;
            text-align: center;
            color: #2c3e50;
            font-size: 56px;
            font-weight: 600;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
            z-index: 1;
            animation: fadeIn 2s ease-in-out;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        .button-container {
            position: absolute;
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1;
        }
        
        .main-button {
            width: 80px;
            height: 80px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }
        
        .main-button i {
            font-size: 40px;
            color: #333;
            transition: all 0.3s ease;
        }
        
        .main-button:hover {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        .corner-button {
            position: absolute;
            width: 60px;
            height: 60px;
            background-color: rgba(255, 255, 255, 0.7);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 2;
        }
        
        .corner-button i {
            font-size: 30px;
            color: #333;
            transition: all 0.3s ease;
        }
        
        .corner-button:hover {
            transform: scale(1.1);
            background-color: rgba(255, 255, 255, 0.9);
        }
        
        .top-left {
            top: 20px;
            left: 20px;
        }
        
        .bottom-left {
            bottom: 20px;
            left: 20px;
        }
        
        .bottom-right {
            bottom: 20px;
            right: 20px;
        }
        
        /* 传记页面样式 */
        .bio-page {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: url('images/qian.jpeg') no-repeat center center fixed;
            background-size: cover;
            display: none;
            flex-direction: column;
            padding: 20px;
            box-sizing: border-box;
            overflow-y: auto;
            z-index: 100;
        }
        
        .bio-content {
            background-color: rgba(255, 255, 255, 0.85);
            border-radius: 10px;
            padding: 30px;
            max-width: 800px;
            margin: 0 auto;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        
        .bio-section {
            margin-bottom: 30px;
            position: relative;
            padding-left: 60px;
        }
        
        .bio-icon {
            position: absolute;
            left: 0;
            top: 0;
            width: 50px;
            height: 50px;
            background-color: rgba(255, 255, 255, 0.9);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        
        .bio-icon:hover {
            transform: scale(1.1);
        }
        
        .icon-1 {
            background-color: rgba(100, 149, 237, 0.9);
        }
        
        .icon-2 {
            background-color: rgba(144, 238, 144, 0.9);
        }
        
        .icon-3 {
            background-color: rgba(255, 182, 193, 0.9);
        }
        
        .icon-4 {
            background-color: rgba(255, 215, 0, 0.9);
        }
        
        h1, h2 {
            color: #2c3e50;
            text-shadow: 1px 1px 2px rgba(255, 255, 255, 0.8);
        }
        
        h1 {
            text-align: center;
            margin-bottom: 30px;
            font-size: 36px;
        }
        
        h2 {
            margin-top: 0;
            font-size: 24px;
            border-bottom: 1px solid #ddd;
            padding-bottom: 10px;
        }
        
        p {
            line-height: 1.6;
            font-size: 18px;
            text-align: justify;
            color: #34495e;
            text-shadow: 1px 1px 1px rgba(255, 255, 255, 0.8);
        }
        
        /* 聊天界面样式 */
        .chat-container {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 85%;
            max-width: 900px;
            height: 75%;
            background-color: rgba(255, 253, 245, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
            display: none;
            flex-direction: column;
            overflow: hidden;
            border: 1px solid #D7CCC8;
            z-index: 100;
        }
        
        .chat-header {
            background: linear-gradient(135deg, #8D6E63 0%, #5D4037 100%);
            color: white;
            padding: 18px 25px;
            text-align: center;
            font-size: 22px;
            font-weight: 600;
            letter-spacing: 1px;
            border-bottom: 2px solid #4E342E;
        }
        
        .chat-messages {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 15px;
            background-color: #FFF8E1;
            background-image: 
                linear-gradient(rgba(215, 204, 200, 0.3) 1px, transparent 1px),
                linear-gradient(90deg, rgba(215, 204, 200, 0.3) 1px, transparent 1px),
                radial-gradient(circle at 20% 30%, rgba(141, 110, 99, 0.05) 0%, transparent 20%),
                radial-gradient(circle at 80% 70%, rgba(93, 64, 55, 0.05) 0%, transparent 20%);
            background-size: 40px 40px, 40px 40px, 200px 200px, 200px 200px;
        }
        
        .message {
            max-width: 80%;
            padding: 15px 20px;
            border-radius: 20px;
            line-height: 1.6;
            position: relative;
            word-wrap: break-word;
            font-size: 18px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }
        
        .user-message {
            align-self: flex-end;
            background: linear-gradient(135deg, #A1887F 0%, #8D6E63 100%);
            color: white;
            border-bottom-right-radius: 5px;
        }
        
        .ai-message {
            align-self: flex-start;
            background: linear-gradient(135deg, #EFEBE9 0%, #D7CCC8 100%);
            color: #3E2723;
            border-bottom-left-radius: 5px;
            border-left: 3px solid #5D4037;
        }
        
        .chat-input-container {
            display: flex;
            padding: 15px;
            background-color: #EFEBE9;
            border-top: 1px solid #D7CCC8;
        }
        
        #messageInput {
            flex: 1;
            padding: 15px 20px;
            border: 1px solid #BCAAA4;
            border-radius: 30px;
            font-family: 'Cambria', serif;
            font-size: 17px;
            outline: none;
            background-color: white;
            transition: all 0.3s;
        }
        
        #messageInput:focus {
            border-color: #8D6E63;
            box-shadow: 0 0 0 2px rgba(141, 110, 99, 0.2);
        }
        
        #sendButton {
            margin-left: 12px;
            width: 55px;
            height: 55px;
            background: linear-gradient(135deg, #5D4037 0%, #3E2723 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
        }
        
        #sendButton:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(62, 39, 35, 0.3);
        }
        
        .back-button {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, #8D6E63 0%, #5D4037 100%);
            color: white;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
            z-index: 101;
        }
        
        .back-button:hover {
            transform: scale(1.1);
            background: linear-gradient(135deg, #5D4037 0%, #3E2723 100%);
        }
        
        .typing-indicator {
            display: none;
            align-self: flex-start;
            background-color: #EFEBE9;
            color: #5D4037;
            padding: 10px 20px;
            border-radius: 20px;
            font-style: italic;
            margin-bottom: 10px;
            border-left: 3px solid #5D4037;
        }
        
        .persona-badge {
            position: absolute;
            top: -10px;
            left: 15px;
            background-color: #5D4037;
            color: white;
            padding: 3px 10px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: bold;
        }
        
        .timestamp {
            font-size: 12px;
            color: #8D6E63;
            margin-top: 5px;
            text-align: right;
        }
        
        /* 粒子效果 */
        .particles {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 0;
        }
        
        .particle {
            position: absolute;
            width: 3px;
            height: 3px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }
        
        @keyframes float {
            0% {
                transform: translateY(0) translateX(0);
                opacity: 1;
            }
            50% {
                opacity: 0.5;
            }
            100% {
                transform: translateY(-100vh) translateX(100px);
                opacity: 0;
            }
        }
        
        /* 钱学森AI加载动画 */
        .typing-dots {
            display: inline-block;
            position: relative;
            width: 80px;
            height: 50px;
        }
        
        .typing-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #5D4037;
            border-radius: 50%;
            position: absolute;
            animation: typingAnimation 1.4s infinite ease-in-out;
        }
        
        .typing-dot:nth-child(1) {
            left: 8px;
            animation-delay: 0s;
        }
        
        .typing-dot:nth-child(2) {
            left: 32px;
            animation-delay: 0.2s;
        }
        
        .typing-dot:nth-child(3) {
            left: 56px;
            animation-delay: 0.4s;
        }
        
        @keyframes typingAnimation {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-8px); }
        }
        
        /* 聊天返回按钮样式 */
        .chat-back-button {
            position: absolute;
            top: 15px;
            right: 15px;
            width: 40px;
            height: 40px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            z-index: 101;
            border: none;
        }
        
        .chat-back-button:hover {
            transform: scale(1.1);
            background-color: white;
        }
    </style>
</head>
<body>
    <div class="particles" id="particles"></div>
    
    <h1 class="main-title">The Eternal East Wind</h1>
    
    <div class="button-container">
        <div class="main-button" id="videoButton">
            <i class="fas fa-film"></i>
        </div>
    </div>
    
    <div class="corner-button top-left" id="bioButton">
        <i class="fas fa-graduation-cap"></i>
    </div>
    
    <div class="corner-button bottom-left" id="backButton">
        <i class="fas fa-arrow-left"></i>
    </div>
    
    <div class="corner-button bottom-right" id="chatButton">
        <i class="fas fa-comment-dots"></i>
    </div>
    
    <!-- 传记页面 -->
    <div class="bio-page" id="bioPage">
        <button class="back-button" id="backFromBio">
            <i class="fas fa-arrow-left"></i>
        </button>
        <div class="bio-content">
            <h1>Qian Xuesen: A Life of Science and Patriotism</h1>
            
            <div class="bio-section">
                <div class="bio-icon icon-1">
                    <i class="fas fa-book"></i>
                </div>
                <h2>Early Education and Academic Achievements</h2>
                <p>Qian Xuesen was born into a scholarly family and demonstrated exceptional intelligence and a strong interest in science from an early age. During his time at Beijing Normal University High School, he excelled academically and was beloved by his teachers. In 1929, he was admitted to the School of Mechanical Engineering at Shanghai Jiao Tong University, marking the beginning of his journey in engineering science.</p>
                <p>While studying abroad in the United States, Qian pursued advanced studies at the Massachusetts Institute of Technology and the California Institute of Technology under the guidance of the world-renowned mechanician Professor Theodore von Kármán. He achieved outstanding accomplishments in various fields including aeronautical engineering, mathematics, and physical mechanics.</p>
            </div>
            
            <div class="bio-section">
                <div class="bio-icon icon-2">
                    <i class="fas fa-flag"></i>
                </div>
                <h2>The Journey Home and Scientific Contributions</h2>
                <p>Upon learning of the founding of the People's Republic of China, Qian Xuesen resolutely decided to abandon his favorable conditions and promising future in the United States to return and contribute to his homeland's development. However, his journey home was fraught with difficulties and hardships. The U.S. authorities obstructed his return with various pretexts, even detaining him. After five years of relentless struggle and the efforts of the Chinese government, Qian finally returned to his beloved homeland in 1955.</p>
                <p>After returning to China, Qian quickly immersed himself in the scientific research endeavors of the new China. He served as the first director of the Fifth Research Institute of the Ministry of National Defense, where he successfully established jet and rocket technologies, and participated in the development of short-range missiles, medium-range missiles, and China's first artificial earth satellite. His scientific achievements not only filled gaps in multiple technological fields in China but also laid a solid foundation for the development of China's aerospace industry.</p>
            </div>
            
            <div class="bio-section">
                <div class="bio-icon icon-3">
                    <i class="fas fa-heart"></i>
                </div>
                <h2>Patriotism and Noble Character</h2>
                <p>Qian Xuesen's life was filled with love and dedication to his country. He once said, "What foreigners can accomplish, Chinese people can accomplish too." This statement not only reflected his firm national confidence and pride but also inspired generations of Chinese scientists and engineers to scale new heights in technology.</p>
                <p>In his scientific work, Qian always maintained a rigorous scientific attitude and meticulous work ethic. He set high standards for himself and poured all his energy and passion into his scientific endeavors. His patriotic spirit and noble character deeply influenced everyone around him.</p>
            </div>
            
            <div class="bio-section">
                <div class="bio-icon icon-4">
                    <i class="fas fa-award"></i>
                </div>
                <h2>Honors and Legacy</h2>
                <p>Qian Xuesen received numerous honors and awards throughout his life. He was hailed as the father of China's missile program, the king of rockets, and the father of Chinese aviation. He was awarded titles such as National Scientist of Outstanding Contribution, First-Class Hero Model Medal, and the "Two Bombs, One Satellite" Medal. His achievements and contributions have left an indelible mark on China's scientific history and continue to inspire countless young students to devote themselves to scientific endeavors and contribute to the prosperity and strength of their homeland.</p>
            </div>
        </div>
    </div>
    
    <!-- 聊天界面 -->
    <div class="chat-container" id="chatContainer">
        <button class="chat-back-button" id="chatBackButton">
            <i class="fas fa-times"></i>
        </button>
        <div class="chat-header">
            Dialogue with Dr. Qian Xuesen
        </div>
        <div class="chat-messages" id="chatMessages">
            <div class="ai-message">
                <div class="persona-badge">Qian Xuesen</div>
                Greetings! I am Qian Xuesen, a scientist dedicated to my country's aerospace development. 
                You may ask me about rocketry, my experiences in America, or my thoughts on scientific progress. 
                How may I assist you today?
            </div>
        </div>
        <div class="chat-input-container">
            <input type="text" id="messageInput" placeholder="Ask Dr. Qian about science, patriotism, or his life..." autocomplete="off">
            <button id="sendButton">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <script>
        // 创建浮动粒子
        const particlesContainer = document.getElementById('particles');
        const particleCount = 50;
        
        for (let i = 0; i < particleCount; i++) {
            const particle = document.createElement('div');
            particle.classList.add('particle');
            
            // 随机位置
            particle.style.left = `${Math.random() * 100}%`;
            particle.style.top = `${Math.random() * 100}%`;
            
            // 随机动画时长和延迟
            particle.style.animationDuration = `${10 + Math.random() * 10}s`;
            particle.style.animationDelay = `${Math.random() * 5}s`;
            
            particlesContainer.appendChild(particle);
        }
        
        // 钱学森AI核心功能
        class QianAI {
            constructor() {
                this.history = [];
                this.persona = {
                    name: "Qian Xuesen",
                    background: "Father of Chinese rocketry, returned from US in 1955",
                    style: "Formal but passionate, mixes technical details with patriotic sentiments"
                };
                this.knowledgeBase = {
                    earlyLife: [
                        "I was born on December 11, 1911 in Hangzhou, Zhejiang Province. My father Qian Jiazhen was a scholar who instilled in me a love for learning from an early age.",
                        "At Beijing Normal University High School, I developed a particular interest in mathematics and physics. My teachers recognized my potential and encouraged me to pursue engineering.",
                        "In 1929, I enrolled at Shanghai Jiao Tong University's School of Mechanical Engineering. The rigorous curriculum there laid the foundation for my future work in aeronautics."
                    ],
                    usExperience: [
                        "At MIT, I studied under Professor Theodore von Kármán, a pioneer in aerodynamics. He became my mentor and lifelong friend.",
                        "During my time at Caltech, I worked on the development of early rocket technology. Our team made significant breakthroughs in jet propulsion theory.",
                        "I served as a consultant to the U.S. Army Air Forces during WWII, helping develop missile guidance systems. This experience proved invaluable for my later work in China."
                    ],
                    returnJourney: [
                        "When I learned of the founding of the People's Republic of China in 1949, I immediately decided to return and contribute to my homeland's development.",
                        "The U.S. government detained me for five years, falsely accusing me of communist sympathies. During this difficult time, I remained steadfast in my determination to serve China.",
                        "Thanks to the efforts of Premier Zhou Enlai and the Chinese government, I finally returned to my motherland in 1955 aboard the SS President Cleveland."
                    ],
                    scientificWork: [
                        "As director of the Fifth Research Institute, I established China's first missile and rocket research program with limited resources.",
                        "The DF-5 intercontinental ballistic missile represented a major breakthrough in Chinese rocketry. Its development taught us valuable lessons about self-reliance.",
                        "Our work on satellite technology culminated in the successful launch of Dongfanghong-1 in 1970, making China the fifth space-faring nation."
                    ],
                    philosophy: [
                        "Scientific progress requires both theoretical knowledge and practical experimentation. This principle guided all my work.",
                        "I always told my students: 'Where there's a will, there's a way.' This belief sustained me through many challenges.",
                        "Patriotism is not contrary to scientific progress. My love for China motivated all my achievements."
                    ],
                    responses: [
                        "That's an excellent question. Let me share my perspective based on my experience...",
                        "I recall a similar situation during my work on... The key lesson was...",
                        "As I often explained to my colleagues, the solution lies in..."
                    ]
                };
            }
            
            async respondTo(message) {
                // 添加到对话历史
                this.history.push({ role: 'user', content: message });
                
                // 模拟思考时间
                const thinkingTime = 800 + Math.random() * 1200;
                await new Promise(resolve => setTimeout(resolve, thinkingTime));
                
                // 生成响应
                let response;
                if (message.toLowerCase().includes('hello') || 
                    message.toLowerCase().includes('hi')) {
                    response = this.getGreeting();
                } else {
                    response = this.generateResponse(message);
                }
                
                this.history.push({ role: 'assistant', content: response });
                return response;
            }
            
            getGreeting() {
                const greetings = [
                    "Greetings! I am Qian Xuesen. How may I share my experiences with you today?",
                    "Hello. As a scientist dedicated to my country's aerospace development, I'm pleased to converse with you.",
                    "Welcome. I'm Qian Xuesen. You may ask me about rocketry, my time in America, or China's scientific progress."
                ];
                return greetings[Math.floor(Math.random() * greetings.length)];
            }
            
            generateResponse(message) {
                const lowerMessage = message.toLowerCase();
                let response;
                
                // 根据关键词选择响应类型
                if (lowerMessage.includes('born') || lowerMessage.includes('childhood')) {
                    response = this.knowledgeBase.earlyLife[
                        Math.floor(Math.random() * this.knowledgeBase.earlyLife.length)
                    ];
                } else if (lowerMessage.includes('america') || lowerMessage.includes('us') || lowerMessage.includes('mit') || lowerMessage.includes('caltech')) {
                    response = this.knowledgeBase.usExperience[
                        Math.floor(Math.random() * this.knowledgeBase.usExperience.length)
                    ];
                } else if (lowerMessage.includes('return') || lowerMessage.includes('china') || lowerMessage.includes('detain')) {
                    response = this.knowledgeBase.returnJourney[
                        Math.floor(Math.random() * this.knowledgeBase.returnJourney.length)
                    ];
                } else if (lowerMessage.includes('work') || lowerMessage.includes('research') || lowerMessage.includes('missile') || lowerMessage.includes('rocket')) {
                    response = this.knowledgeBase.scientificWork[
                        Math.floor(Math.random() * this.knowledgeBase.scientificWork.length)
                    ];
                } else if (lowerMessage.includes('philosophy') || lowerMessage.includes('belief') || lowerMessage.includes('think')) {
                    response = this.knowledgeBase.philosophy[
                        Math.floor(Math.random() * this.knowledgeBase.philosophy.length)
                    ];
                } else {
                    const baseResponse = this.knowledgeBase.responses[
                        Math.floor(Math.random() * this.knowledgeBase.responses.length)
                    ];
                    response = `${baseResponse} ${this.getRandomFact()}`;
                }
                
                return response;
            }
            
            getRandomFact() {
                const allFacts = [
                    ...this.knowledgeBase.earlyLife,
                    ...this.knowledgeBase.usExperience,
                    ...this.knowledgeBase.returnJourney,
                    ...this.knowledgeBase.scientificWork,
                    ...this.knowledgeBase.philosophy
                ];
                return allFacts[Math.floor(Math.random() * allFacts.length)];
            }
        }

        // 初始化AI实例
        const qianAI = new QianAI();
        
        // 页面交互功能
        const videoButton = document.getElementById('videoButton');
        const bioButton = document.getElementById('bioButton');
        const backButton = document.getElementById('backButton');
        const chatButton = document.getElementById('chatButton');
        const chatContainer = document.getElementById('chatContainer');
        const bioPage = document.getElementById('bioPage');
        const backFromBio = document.getElementById('backFromBio');
        const chatMessages = document.getElementById('chatMessages');
        const messageInput = document.getElementById('messageInput');
        const sendButton = document.getElementById('sendButton');
        const chatBackButton = document.getElementById('chatBackButton');
        
        // 视频按钮功能 - 跳转到B站视频
        videoButton.addEventListener('click', () => {
            window.open('https://www.bilibili.com/video/BV1yb4y1J7Cu/?spm_id_from=333.1007.top_right_bar_window_history.content.click&vd_source=9f2e7f7c520e5461bf6db8ad014f9c0e', '_blank');
        });
        
        // 传记按钮功能
        bioButton.addEventListener('click', () => {
            bioPage.style.display = 'flex';
        });
        
        backFromBio.addEventListener('click', () => {
            bioPage.style.display = 'none';
        });
        
        // 聊天按钮功能
        chatButton.addEventListener('click', () => {
            chatContainer.style.display = 'flex';
        });
        
        // 聊天返回按钮功能
        chatBackButton.addEventListener('click', () => {
            chatContainer.style.display = 'none';
        });
        
        // 返回按钮功能
        backButton.addEventListener('click', () => {
            window.history.back();
        });
        
        // 聊天界面功能
        function addMessage(content, isUser) {
            const messageDiv = document.createElement('div');
            messageDiv.classList.add('message');
            messageDiv.classList.add(isUser ? 'user-message' : 'ai-message');
            
            if (!isUser) {
                const badge = document.createElement('div');
                badge.classList.add('persona-badge');
                badge.textContent = qianAI.persona.name;
                messageDiv.appendChild(badge);
            }
            
            const contentNode = document.createElement('div');
            contentNode.textContent = content;
            messageDiv.appendChild(contentNode);
            
            const timestamp = document.createElement('div');
            timestamp.classList.add('timestamp');
            timestamp.textContent = new Date().toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
            messageDiv.appendChild(timestamp);
            
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function showTyping() {
            const typingDiv = document.createElement('div');
            typingDiv.classList.add('typing-indicator');
            typingDiv.id = 'typingIndicator';
            
            const dotsContainer = document.createElement('div');
            dotsContainer.classList.add('typing-dots');
            
            for (let i = 0; i < 3; i++) {
                const dot = document.createElement('div');
                dot.classList.add('typing-dot');
                dotsContainer.appendChild(dot);
            }
            
            typingDiv.appendChild(document.createTextNode('Dr. Qian is thinking '));
            typingDiv.appendChild(dotsContainer);
            
            chatMessages.appendChild(typingDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }
        
        function hideTyping() {
            const typingIndicator = document.getElementById('typingIndicator');
            if (typingIndicator) {
                typingIndicator.remove();
            }
        }
        
        async function sendMessage() {
            const message = messageInput.value.trim();
            if (!message) return;
            
            addMessage(message, true);
            messageInput.value = '';
            
            showTyping();
            
            try {
                const response = await qianAI.respondTo(message);
                addMessage(response, false);
            } catch (error) {
                addMessage("My apologies, I seem to be having technical difficulties.", false);
                console.error(error);
            } finally {
                hideTyping();
            }
        }
        
        // 事件监听
        sendButton.addEventListener('click', sendMessage);
        messageInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                sendMessage();
            }
        });
    </script>
</body>
</html>
